# Case02：購買ログEDAによる顧客理解と前提条件の検証  
**（SQL × Python）**

## 背景・想定シナリオ
ECサイトにおいて、
CRM施策やプロモーション最適化の高度化が検討されている一方で、
現状では購買ログ以外の行動データが十分に整備されていないという課題がある。

PdMから、以下の依頼を受けた想定とする。

> 「将来的に顧客をセグメントして施策を出し分けたいと考えているが、
> 現状の購買ログだけで、
> 顧客を分けて考える意味のある行動差が存在するのかをまず確認したい」

本ケースでは、
購買ログを用いた探索的データ分析（EDA）を通じて、
追加の分析や施策設計を行う前提条件が成立するかを検証することを目的とする。

---

## 分析目的
- 購買ログから顧客単位の行動指標を整理する
- 顧客を分けて考えるだけの意味のある行動差が存在するかを確認する
- 施策設計や高度な分析に進む妥当性を判断する

---

## 分析方針
- 仮説を固定せず、EDAを通じてデータの分布や構造を把握する
- 差が確認できない場合も、分析結果としてそのまま受け入れる
- SQLとPythonを役割分担し、分析プロセスの可読性と再現性を重視する

---

## 使用データ
本ケースでは、公開データセットである **Brazilian E-Commerce Public Dataset by Olist** を使用している。

- orders
  - 注文ID、購入日時、配送日時、注文ステータス
- customers
  - 顧客ID、居住都市・州情報
- order_items
  - 注文内の商品情報（商品ID、価格、送料など）
- order_payments
  - 注文ごとの支払金額・支払方法
- products / product_category_name_translation
  - 商品カテゴリ情報（ポルトガル語 → 英語翻訳）

参考：Brazilian E-Commerce Public Dataset by Olist
https://www.kaggle.com/datasets/olistbr/brazilian-ecommerce

※ データそのものはリポジトリには含めていない。

---

## 分析プロセス

### 1. SQLによる指標・特徴量設計
注文（order）単位のデータを起点に、顧客単位（customer_unique_id）へ集約
delivered の注文のみを対象とし、RFM分析の考え方をベースに購買行動を整理
SQL上で以下の主要な指標・特徴量を設計・算出
- Recency：最新購買日からの経過日数
- Frequency：購買回数
- Monetary：累計購買金額
- 初回購買日・初回購買金額
- 購買カテゴリの多様性および最頻カテゴリ

RFMを軸とした顧客理解に必要な指標をSQLで一貫して生成する設計とし、
Python側では集計処理を行わず、EDA・可視化・セグメンテーションに専念できる構成とした。

---

### 2. PythonによるEDA
SQLで作成した顧客単位データをもとに、EDAを実施。

- 各指標の分布確認
- リピート顧客／非リピート顧客の比較
- 極端な外れ値や偏りの確認
- 指標間の関係性の可視化

EDAを通じて、  
「顧客を分けて考える意味があるか」に注目した。

---

## 結果・解釈

### 主な結果
- 初回購買金額や初回購買カテゴリのみでは、
  リピート行動を十分に説明できない
- 顧客間の指標分布は連続的で、
  明確な分離構造は確認できなかった
- 本データのみを用いた
  - 顧客セグメンテーション
  - 要因分析
  の妥当性は低いと判断

---

## 結論
本購買ログデータに基づく分析では、

- 顧客行動の差異を説明する情報が不足しており
- 施策設計やモデル化を行う前提条件は成立していない

と結論づけた。

---

## ネクストアクション
- 閲覧履歴、接触履歴、キャンペーン接触情報など、
  行動文脈を補足するデータの追加
- 追加データ取得後、改めてEDA・分析方針を検討

---

## 本ケースのポイント
- **EDAを「前提条件の検証」として位置づけ**
- 分析を進めないという判断を、実務上の結論として明示
- SQLとPythonの役割を分離し、分析プロセスを明確化
- 無理に施策やモデルにつなげない判断を重視

---

## ディレクトリ構成
```text
case02/
├─ README.md
├─ sql/            # 顧客単位指標の作成クエリ
├─ notebooks/      # EDA用ノートブック
└─ reports/        # 図表・要約資料
